# ch3.네트워크 계층

## 네트워크 계층

- 물리 계층과 데이터 링크 계층 → LAN에 국한된 통신
- LAN을 넘어서기 위한 계층
- 네트워크 간 통신이 가능한 계층 → 라우팅(패킷을 목적지까지 최적의 경로로 찾아가는 과정)
- 단편화가 이루어지는 계층

---

# IP (논리적 주소)

vs 데이터링크 계층의 MAC주소 : 물리적 주소

- MAC주소만으로 도달 경로를 파악하기 어려움(라우팅 어려움)
- 임의의 네트워크에 속한 호스트의 MAC 주소를 기억하기 어려움

→ MAC주소와 IP주소를 동시에, IP주소를 더 우선적으로 활용하여 통신함

MAC주소는 발신인,수신인  

IP주소는 발신주소,수신주소로 비유할 수 있음

- 직접할당과 자동할당(DHCP)

### IP의 두가지 주요 기능

- IP 주소 지정
- 단편화

### 단편화

- 패킷의 크기를 MTU(Maximum Transmission Unit) 이하로 유지
- MTU 크기 이하로 단편화된 패킷들은 목적지에서 재조합
- MTU 크기에 따라 성능에 영향이 있음

### IPv4 헤더

- 송신지, 목적지 IP 주소 (192.18.100.12)
- 식별자 : 패킷에 할당된 번호 (재조합시 사용)
- 플래그 : 부가 정보 (3비트 구성 : 미사용(항상 0), Don’t Fragment, More Fragement 비트)
- 단편화 오프셋 : 단편화되기 전 데이터가 얼마나 떨어져 있는가
- TTL(Time To Live, 패킷의 수명, 라우터를 거칠 때마다 1 감소) , 프로토콜

### **IPv4 주소**

- 4바이트(32비트)로 표현 가능 , 점을 기준으로 4개의 숫자로 표현
- 한 옥텟은 0~255 범위의 네 개의 십진수로 표기
- 이론적으로 할당 가능한 IPv4 주소 개수 == 2^32개
    - 그러나 넉넉한 양이 아니다, IP 주소 부족 문제 발생

### **IPv6 주소**

- 16바이트 (128비트)로 표현 가능
- 이로ㅓㄴ적으로 할당 가능한 IPv6 주소 개수 == 2^128개 ← 사실상 무한

### **IPv6 헤더**

- 더 단순한 구조

---

# ARP

ARP는 IP주소를 통해 MAC 주소를 알아내기 위한 프로토콜

동일 네트워크 내의 호스트의 MAC 주소를 알아내기 위한 프로토콜

### ARP 동작 과정

1.ARP 요청

2.ARP 응답

3.ARP 테이블(ARP 캐시) 갱신

→ IP주소와 MAC주소 획득

ARP 패킷을 주고 받음

### 1. ARP 요청 (브로드캐스트 메세지)

특정 IP 주소를 가진 호스트의 MAC 주소를 알아내기 위해 보내는 브로드 캐스트 메세지

해당 호스트의 MAC 주소를 모르기 때문에 브로드캐스트 메세지로 전송

→ 허공에 대고 소리치는것과 같다. 

### 2. ARP 응답

ARP 요청 메세지에 대한 응답. 자신의 MAC 주소 포함.

### 3. ARP 테이블 갱신

- ARP 테이블 (ARP 캐시): MAC 주소와 IP주소가 매핑된 표 형태의 데이터
- 일정 시간이 지나면 삭제
- ARP 테이블에 추가된 호스트는 브로드 캐스트로 ARP 요청 보낼 필요 없음

cf) arp -a 명령어

cf) ARP가 닿는 범위를 LAN의 근거리 네트워크 범위라고 보는 관점도 있다.

---

# ICMP

### IP의 한계

- 비신뢰성 : 패킷이 목적지까지 제대로 전송된다는 보장이 없는 특성 , 최선형전달(best-effort delivery)라고도 부름
- 비연결형 : 호스트 간의 사전 연결 수립이 없는 특성

신뢰성 프로토콜, 연결형 프로토콜을 제공하는 계층은 전송계층 (TCP)

전송계층을 이용하면 IP의 한계를 극복할 수 있다.

### ICMP

IP의 비신뢰성과 비연결형 특성을 보완하기 위한 네트워크 계층의 프로토콜

IP 패킷의 전송 과정에 대한 피드백 메세지 제공

- 오류 보고
- 네트워크 진단 정보
    - 오류 보고
    - 네트워크 진단 정보

ICMP 메세지는 타입과 코드로 정의 (에코 요청, 에코 응답)

cf) traceroute google.com

---

# IP 주소

IP 주소의 구성: 네트워크 주소, 호스트 주소 (유동적)

172.16.12.45  ( e.g.; 앞 두 옥텟이 네트워크 주소, 뒤 두 옥텟이 호스트주소)

MAC 주소의 구성도 마찬가지 : 제조사 번호, 일련 번호

그러나 네트워크 주소의 크기와 호스트 주소의 크기는 변동성이 있음

### 클래스풀 주소체계

A클래스, B클래스, C클래스 + (D,E클래스 : 예약된 주소)

- 호스트 주소부가 전부 0인 경우 : 네트워크 주소를 나타냄
- 호스트 주소부가 전부 1인 경우 : 브로드캐스트를 나타냄

### 클래스리스 주소쳬계

- 클래스풀 주소 체계보다 더 정교히 네트워크를 나누는 방법
- 오늘날 주로 사용하는 방식
- 네트워크와 호스트를 구분하기 위해 **서브넷 마스크** 이용

### 서브넷 마스크

- IP 주소 상에서 네트워크 주소는 1, 호스트 주소는 0으로 이루어진 비트열

→ 서브넷 마스크와 IP주소의 비트 AND 연산 : 네트워크 주소

### CIDR 표기

- 서브넷 마스크 상의 1의 개수를 IP주소/숫자 로 표기
- 192.168.100.103/30
    - IP Address , Network Address, Usable Host IP Range, Braodcast Address , Total  Number of Hosts, Number of Usable Hosts, Subnet Mask 파악 가능해야함

---

# IP 주소의 분류

---

# 라우팅